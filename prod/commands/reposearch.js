/*
RESPONSE:

{
  "total_count": 14378,
  "incomplete_results": false,
  "items": [
    {
      "id": 40484398,
      "node_id": "MDEwOlJlcG9zaXRvcnk0MDQ4NDM5OA==",
      "name": "discord.js",
      "full_name": "discordjs/discord.js",
      "private": false,
      "owner": {
        "login": "discordjs",
        "id": 26492485,
        "node_id": "MDEyOk9yZ2FuaXphdGlvbjI2NDkyNDg1",
        "avatar_url": "https://avatars.githubusercontent.com/u/26492485?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/discordjs",
        "html_url": "https://github.com/discordjs",
        "followers_url": "https://api.github.com/users/discordjs/followers",
        "following_url": "https://api.github.com/users/discordjs/following{/other_user}",
        "gists_url": "https://api.github.com/users/discordjs/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/discordjs/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/discordjs/subscriptions",
        "organizations_url": "https://api.github.com/users/discordjs/orgs",
        "repos_url": "https://api.github.com/users/discordjs/repos",
        "events_url": "https://api.github.com/users/discordjs/events{/privacy}",
        "received_events_url": "https://api.github.com/users/discordjs/received_events",
        "type": "Organization",
        "site_admin": false
      },
      "html_url": "https://github.com/discordjs/discord.js",
      "description": "A powerful JavaScript library for interacting with the Discord API",
      "fork": false,
      "url": "https://api.github.com/repos/discordjs/discord.js",
      "forks_url": "https://api.github.com/repos/discordjs/discord.js/forks",
      "keys_url": "https://api.github.com/repos/discordjs/discord.js/keys{/key_id}",
      "collaborators_url": "https://api.github.com/repos/discordjs/discord.js/collaborators{/collaborator}",
      "teams_url": "https://api.github.com/repos/discordjs/discord.js/teams",
      "hooks_url": "https://api.github.com/repos/discordjs/discord.js/hooks",
      "issue_events_url": "https://api.github.com/repos/discordjs/discord.js/issues/events{/number}",
      "events_url": "https://api.github.com/repos/discordjs/discord.js/events",
      "assignees_url": "https://api.github.com/repos/discordjs/discord.js/assignees{/user}",
      "branches_url": "https://api.github.com/repos/discordjs/discord.js/branches{/branch}",
      "tags_url": "https://api.github.com/repos/discordjs/discord.js/tags",
      "blobs_url": "https://api.github.com/repos/discordjs/discord.js/git/blobs{/sha}",
      "git_tags_url": "https://api.github.com/repos/discordjs/discord.js/git/tags{/sha}",
      "git_refs_url": "https://api.github.com/repos/discordjs/discord.js/git/refs{/sha}",
      "trees_url": "https://api.github.com/repos/discordjs/discord.js/git/trees{/sha}",
      "statuses_url": "https://api.github.com/repos/discordjs/discord.js/statuses/{sha}",
      "languages_url": "https://api.github.com/repos/discordjs/discord.js/languages",
      "stargazers_url": "https://api.github.com/repos/discordjs/discord.js/stargazers",
      "contributors_url": "https://api.github.com/repos/discordjs/discord.js/contributors",
      "subscribers_url": "https://api.github.com/repos/discordjs/discord.js/subscribers",
      "subscription_url": "https://api.github.com/repos/discordjs/discord.js/subscription",
      "commits_url": "https://api.github.com/repos/discordjs/discord.js/commits{/sha}",
      "git_commits_url": "https://api.github.com/repos/discordjs/discord.js/git/commits{/sha}",
      "comments_url": "https://api.github.com/repos/discordjs/discord.js/comments{/number}",
      "issue_comment_url": "https://api.github.com/repos/discordjs/discord.js/issues/comments{/number}",
      "contents_url": "https://api.github.com/repos/discordjs/discord.js/contents/{+path}",
      "compare_url": "https://api.github.com/repos/discordjs/discord.js/compare/{base}...{head}",
      "merges_url": "https://api.github.com/repos/discordjs/discord.js/merges",
      "archive_url": "https://api.github.com/repos/discordjs/discord.js/{archive_format}{/ref}",
      "downloads_url": "https://api.github.com/repos/discordjs/discord.js/downloads",
      "issues_url": "https://api.github.com/repos/discordjs/discord.js/issues{/number}",
      "pulls_url": "https://api.github.com/repos/discordjs/discord.js/pulls{/number}",
      "milestones_url": "https://api.github.com/repos/discordjs/discord.js/milestones{/number}",
      "notifications_url": "https://api.github.com/repos/discordjs/discord.js/notifications{?since,all,participating}",
      "labels_url": "https://api.github.com/repos/discordjs/discord.js/labels{/name}",
      "releases_url": "https://api.github.com/repos/discordjs/discord.js/releases{/id}",
      "deployments_url": "https://api.github.com/repos/discordjs/discord.js/deployments",
      "created_at": "2015-08-10T13:36:26Z",
      "updated_at": "2023-08-11T09:04:53Z",
      "pushed_at": "2023-08-11T10:47:49Z",
      "git_url": "git://github.com/discordjs/discord.js.git",
      "ssh_url": "git@github.com:discordjs/discord.js.git",
      "clone_url": "https://github.com/discordjs/discord.js.git",
      "svn_url": "https://github.com/discordjs/discord.js",
      "homepage": "https://discord.js.org",
      "size": 43555,
      "stargazers_count": 23756,
      "watchers_count": 23756,
      "language": "TypeScript",
      "has_issues": true,
      "has_projects": true,
      "has_downloads": true,
      "has_wiki": false,
      "has_pages": false,
      "has_discussions": true,
      "forks_count": 3960,
      "mirror_url": null,
      "archived": false,
      "disabled": false,
      "open_issues_count": 154,
      "license": {
        "key": "apache-2.0",
        "name": "Apache License 2.0",
        "spdx_id": "Apache-2.0",
        "url": "https://api.github.com/licenses/apache-2.0",
        "node_id": "MDc6TGljZW5zZTI="
      },
      "allow_forking": true,
      "is_template": false,
      "web_commit_signoff_required": false,
      "topics": [
        "bot",
        "discord",
        "discord-api",
        "discord-bot",
        "discord-server",
        "discordjs",
        "hacktoberfest",
        "nodejs",
        "voice-support"
      ],
      "visibility": "public",
      "forks": 3960,
      "open_issues": 154,
      "watchers": 23756,
      "default_branch": "main",
      "score": 1
    },
    ...
    ]
}

*/ 
function gitMessageReply(data){
    const { EmbedBuilder } = require('discord.js');
    const embed = new EmbedBuilder()
        .setTitle('GitHub Repository Search')
        .setDescription(`Total results: ${data.total_count}`)
        .setColor('#0099ff')
        .setTimestamp()
        // Dinamically add fields in 
        // (method) EmbedBuilder.setFields(...fields: RestOrArray<APIEmbedField>): EmbedBuilder
        embed.setFields(data.items.map((item, index) => {
            return {
                // [discordjs](https://github.com/discordjs/discord.js)
                name: `#${index + 1} ${item.name}`,
                value: `${item.description}\n üåü ${item.stargazers_count} | üîó ${item.forks_count} | üìù ${item.open_issues_count} | üëÅ ${item.watchers_count} | üåé ${item.language}\n
                [View Repo](${item.html_url})`,
                inline: false
            }
        }));
    return embed;
}

module.exports = {
    name: 'reposearch',
    description: 'Search for a repository on GitHub by name or github deep search query.',
    async execute(interaction) {
        const reposearch = require('../lib/github/reposearch.js');
        const query = interaction.options.getString('query');
        const result = await reposearch(query);
        const embed = gitMessageReply(result);
        await interaction.reply({ embeds: [embed] });
    },
    options: [
        {
            name: 'query',
            description: 'Query to search for repositories.',
            type: 3,
            required: true
        }
    ]
}